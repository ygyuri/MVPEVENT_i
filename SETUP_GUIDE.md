# Complete Setup Guide for Event-i

## Docker (Dev) Quick Start

Run these from the project root:

```bash
cd /Users/brix/Documents/GitHub/MVPEVENT_i
docker compose up -d --build
```

Verify services:

```bash
docker compose ps
curl -sS http://localhost:5000/api/health
```

Open:

- API: http://localhost:5000/api/health
- Client: http://localhost:3000
- Mongo Express: http://localhost:8081

Notes:

- `start-dev.sh` is optional and only for non-Docker local runs. Prefer `docker compose up -d`.
- To stop everything and remove volumes: `docker compose down -v`

## Quick Fix for Checkout Issues

The checkout validation issues have been resolved with the following fixes:

### 1. Fixed Event ID Reference âœ…
- **Issue**: `currentEvent._id` was undefined
- **Fix**: Changed to `currentEvent.id` in EventDetails.jsx
- **Result**: Cart items now have valid event IDs

### 2. Fixed Order Model Schema âœ…
- **Issue**: `orderNumber` field was required but generated by middleware
- **Fix**: Changed `required: true` to `required: false` in Order.js
- **Result**: Orders can now be created successfully

### 3. Fixed Ticket Type Validation âœ…
- **Issue**: Order service expected `event.ticketTypes` in database
- **Fix**: Added dynamic ticket type generation in orderService.js
- **Result**: Order validation now works with seeded events

## Docker Setup Instructions

### Option 1: Start Docker Daemon and Use Docker Compose

1. **Start Docker Desktop** (if using Docker Desktop)
   ```bash
   # On macOS, start Docker Desktop application
   open -a Docker
   ```

2. **Start the services**
   ```bash
   cd /Users/brix/Documents/GitHub/MVPEVENT_i
   docker compose up -d
   ```

3. **Check if services are running**
   ```bash
   docker compose ps
   ```

4. **View logs**
   ```bash
   docker compose logs -f server
   ```

### Option 2: Run Without Docker (Recommended for Development)

1. **Install MongoDB locally**
   ```bash
   # Using Homebrew on macOS
   brew tap mongodb/brew
   brew install mongodb-community
   brew services start mongodb/brew/mongodb-community
   ```

2. **Create the database and seed data**
   ```bash
   # Connect to MongoDB
   mongosh
   
   # Create database and user
   use event_i
   db.createUser({
     user: "admin",
     pwd: "password123",
     roles: ["readWrite"]
   })
   
   # Exit mongosh
   exit
   ```

3. **Start the server**
   ```bash
   cd /Users/brix/Documents/GitHub/MVPEVENT_i/server
   npm start
   ```

4. **Start the client** (in another terminal)
   ```bash
   cd /Users/brix/Documents/GitHub/MVPEVENT_i/client
   npm run dev
   ```

### Option 3: Use Docker with Manual Database Setup

1. **Start only MongoDB container**
   ```bash
   docker run -d \
     --name event_i_mongodb \
     -p 27017:27017 \
     -e MONGO_INITDB_ROOT_USERNAME=admin \
     -e MONGO_INITDB_ROOT_PASSWORD=password123 \
     -e MONGO_INITDB_DATABASE=event_i \
     mongo:7.0
   ```

2. **Wait for MongoDB to start**
   ```bash
   sleep 10
   ```

3. **Seed the database**
   ```bash
   cd /Users/brix/Documents/GitHub/MVPEVENT_i/server
   npm run seed
   ```

4. **Start the server**
   ```bash
   npm start
   ```

## Testing the Fix

Once the server is running, test the checkout flow:

1. **Open the application** at `http://localhost:3000` (or `http://localhost:3001` if port 3000 is busy)

2. **Navigate to an event** and add items to cart

3. **Go to checkout** and fill in customer information

4. **Submit the form** - it should now work without validation errors

## Verification

The checkout should now work with this response:
```json
{
  "success": true,
  "message": "Order created successfully",
  "data": {
    "orderId": "...",
    "orderNumber": "ORD-...",
    "pricing": {
      "subtotal": 179,
      "serviceFee": 9,
      "total": 188,
      "currency": "KES"
    },
    "status": "pending"
  }
}
```

## Troubleshooting

### If cart is still empty:
1. Check browser console for errors
2. Verify that events are loading properly
3. Check that items are being added to cart with valid event IDs

### If server won't start:
1. Check if port 5000 is available: `lsof -ti:5000`
2. Kill any processes using port 5000: `lsof -ti:5000 | xargs kill -9`
3. Check MongoDB connection

### If database connection fails:
1. Ensure MongoDB is running
2. Check connection string in server/config/database.js
3. Verify database credentials

## Summary of Changes Made

1. **EventDetails.jsx**: Fixed `currentEvent._id` â†’ `currentEvent.id`
2. **Events.jsx & Home.jsx**: Standardized event ID usage
3. **Order.js**: Fixed `orderNumber` field requirement
4. **orderService.js**: Added dynamic ticket type generation
5. **checkoutSlice.js**: Improved cart validation logic
6. **CustomerInfoForm.jsx**: Added debugging logs

The checkout flow should now work completely! ðŸŽ‰



